<!DOCTYPE html>
<html lang="en" class="huodongxing">
	<head>
		<title>活动行 - 个人设置_我的活动行_精彩城市生活，尽在活动行！！</title>
        <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

	<link href="./static/css/bootstrap.min.css" rel="stylesheet"/>
		<link href="./static/css/font-awesome.min.css" rel="stylesheet">
		<link rel="stylesheet" href="./static/css/base.css"> 
		
		<script src="./static/js/com.js"></script>

		
		<link href="./static/css/hdx.min.css" rel="stylesheet" type="text/css" />
 
		<!--[if lte IE 6]><link href="./static/css/ie6-fix.css" type="text/css" rel="stylesheet"><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" type="text/css" href="./static/css/ie.css" /><![endif]-->
		
     	<!--[if lt IE 9]><script type="text/javascript" src="./static/js/ie/html5.js"></script><![endif]-->

		<script src="./static/js/jquery/jquery.js" type="text/javascript"></script>

		
	<link href="./static/css/jquery/jquery.fileupload-ui.css" rel="stylesheet" type="text/css" />
	<link href="./static/css/jquery/jquery.Jcrop.min.css" rel="stylesheet" type="text/css" />
    <link href="./static/css/user_page.min.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript" src="./static/js/jquery/jquery.validate.min.js"></script>
	<script type="text/javascript" src="./static/js/jquery/messages_cn.js"></script>
	<script type="text/javascript" src="./static/js/jquery/jquery.unobtrusive-ajax.min.js"></script>
	<script type="text/javascript" src="./static/js/jquery/jquery.validate.unobtrusive.min.js"></script>
	<script type="text/javascript" src="./static/js/bootstrap/bootstrap-form.js"></script>

	<script type="text/javascript" src="./static/js/jquery/jquery.ui.widget.js"></script>
	<script type="text/javascript" src="./static/js/jquery/jquery.iframe-transport.js"></script>
	<script type="text/javascript" src="./static/js/jquery/jquery.fileupload.js"></script>
	<script type="text/javascript" src="./static/js/jquery/jquery.fileupload-fp.js"></script>
	<script type="text/javascript" src="./static/js/jquery/jquery.Jcrop.min.js"></script>
	<script type="text/javascript" src="./static/js/bootstrap/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="./static/js/select-city.min.js"></script>

	<!-- The XDomainRequest Transport is included for cross-domain file deletion for IE8+ -->
    <!--[if gte IE 8]><script src="./static/js/jquery/cors/jquery.xdr-transport.js"></script><![endif]-->

	</head>
	<body class="huodongxing">
        <!--[if lte IE 6]><script src="./static/js/ie/warning.js"></script><script>window.onload=function(){e("./static/img/");}</script><![endif]-->
		
	<!-- nav-->
	<script>util.topnav(1);</script> 
		
<div class="user-page-new container-lg">
    <div class="user-main2">
        <div class="user-nav">
    <div class="avatar">
        <a href="./index.html">
            <img src="http://qzapp.qlogo.cn/qzapp/100306609/15158C509654BB7A4AE0D9E772EBA691/30" alt="">iFlare
        </a>
    </div>
    <ul>
        <li><a href="./account_profile.html"><span class="icon-nav-user"></span>个人资料设置</a></li>
        <li><a href="./account_changepwd.html"><span class="icon-nav-password"></span>修改密码</a></li>
        <li><a href="./account_orgnizers.html"><span class="icon-event-org"></span>主办方资料</a></li>
        <li><a href="./account_payment.html"><span class="icon-event-price"></span>收款帐户设置</a></li>
        <li><a href="./account_invoice.html"><span class="icon-event-price"></span>发票信息设置</a></li>
    </ul>
</div>
        <div class="content">
            <h1>
                <a href="./index.html" class="text-primary pull-right small">返回我的活动行</a>
                个人资料设置
            </h1>
<form action="" class="form-horizontal" enctype="multipart/form-data" id="user_logo_upload_form" method="post">                

                <fieldset> 
                    <div class="form-group">
                        <label class="control-label" >个人头像</label>
                        <div>
                            <img id="user_logo_image" title="大头像" alt="大头像" src="http://qzapp.qlogo.cn/qzapp/100306609/15158C509654BB7A4AE0D9E772EBA691/30">
                            <div class="preview-container">
                                <img id="preview" style="width: 86px; height: 86px; margin-left: -16px; margin-top: -16px;" title="小头像" alt="小头像" src="http://qzapp.qlogo.cn/qzapp/100306609/15158C509654BB7A4AE0D9E772EBA691/30">
                            </div>
                            <div>
                                <p>
                                    上传的头像会自动生成头像缩略图，您也可
                                    以拖动大图的裁减区域，调整缩图内容。
                                    <br/>
                                    支持JPG、GIF、PNG等图片格式
                                    推荐尺寸：180*180像素
                                </p>
                                <div class="btn btn-create-default btn-lg btn-file">
                                    上传头像<input type="file" id="user_logo_upload_file" name="user_logo_upload_file" />
                                </div>
                                <button class="btn btn-primary btn-lg" id="crop_small_logo" title="拖动剪裁区域，裁剪您满意的部分" onclick="javascript:saveSmallLogo();return false;">保存</button>
                            </div>
                        </div>
                    </div>
                </fieldset>
</form><form action="/profile" class="" id="edit_profile_form" method="post">                <fieldset>
                    <input id="Account" name="Account" type="hidden" value="1362353926464" />
                    <input id="Logo" name="Logo" type="hidden" value="http://qzapp.qlogo.cn/qzapp/100306609/15158C509654BB7A4AE0D9E772EBA691/30" />
                    <input id="LogoLarge" name="LogoLarge" type="hidden" value="http://qzapp.qlogo.cn/qzapp/100306609/15158C509654BB7A4AE0D9E772EBA691/30" />
                    <input data-val="true" data-val-required="The EmailActivated field is required." id="EmailActivated" name="EmailActivated" type="hidden" value="False" />
                    <input data-val="true" data-val-required="The PhoneActivated field is required." id="PhoneActivated" name="PhoneActivated" type="hidden" value="False" />
                    <input id="Country" name="Country" type="hidden" value="" />
                    <input id="Province" name="Province" type="hidden" value="" />
                    <input id="City" name="City" type="hidden" value="" />
                    <input id="Birthday" name="Birthday" type="hidden" value="" />
                    <div class="form-group">
                        <label class="control-label" >昵称<em style="color:red;">*</em></label>
                        <div class="controls">
                            <input class="form-control form-control-block  required" data-val="true" data-val-length="字符长度不能超过50" data-val-length-max="50" data-val-required="必填" id="Nick" name="Nick" type="text" value="iFlare" />
                            <span class="field-validation-valid" data-valmsg-for="Nick" data-valmsg-replace="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" >真实姓名</label>
                        <div class="controls">
                            <input class="form-control form-control-block" data-val="true" data-val-required="必填" id="RealName" name="RealName" type="text" value="" />
                            <span class="field-validation-valid" data-valmsg-for="RealName" data-valmsg-replace="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" >一句话介绍</label>
                        <div class="controls">
                            <input class="form-control form-control-block" id="Brief" name="Brief" type="text" data-val-length-max="60" data-val-length="介绍不能超过60字" data-val="true" value="一句话介绍">
						
                            <span class="field-validation-valid" data-valmsg-for="Brief" data-valmsg-replace="true"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" >手机号码<em style="color:red;">*</em></label>
                        <div class="controls">
<input class="form-control" data-val="true" data-val-regex="电话号码必须仅包含数字" data-val-regex-pattern="^\+?(([0-9]+)|([0-9]+\-?)|([0-9]+\*?)|([0-9]+\s?)){4,16}$" data-val-required="必填" id="edit_profile_phone" name="Phone" type="text" value="" />                                <button id="btnValidPhone" type="button" class="btn btn-primary" onclick="javascript:startValidUserContact(1,$('#edit_profile_phone').val(),false,refreshProfilePage);"><i class="icon-ok-sign icon-white"></i>&nbsp;立即验证</button>
<span class="field-validation-valid" data-valmsg-for="Phone" data-valmsg-replace="true"></span>                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" >电子邮箱<em style="color:red;">*</em></label>
                        <div class="controls" style="padding-top: 14px;">
<input class="form-control input-xlarge" data-val="true" data-val-length="电子邮箱的长度不能超过50字" data-val-length-max="50" data-val-regex="无效的Email地址" data-val-regex-pattern="^([A-Za-z0-9]+)(([A-Za-z0-9]+)|(_+)|(\-+)|(\.+)|(\++))*@((\w+\-+)|(\w+\.))*\w{1,63}\.[a-zA-Z]{2,6}$" data-val-required="必填" id="edit_profile_email" name="Email" type="text" value="" />                                <button id="btnValidEmail" type="button" class="btn btn-primary" onclick="javascript:startValidUserContact(0,$('#edit_profile_email').val(),true,refreshProfilePage);"><i class="icon-ok-sign icon-white"></i>&nbsp;立即验证</button>
<span class="field-validation-valid" data-valmsg-for="Email" data-valmsg-replace="true"></span>                        </div>
                    </div>
				 
                    <div class="form-group">
                        <label class="control-label" >所在地区<em style="color:red;">*</em></label>
                        <div class="controls" id="ChinaArea">
                            <select id="pro" class="input-medium" style="width:116px;"></select>
                            <select id="city" class="input-medium"></select>
                            <input type="hidden"  name="Province"  value="" />
                            <input type="hidden"  name="City"  value=""/>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" >性别</label>
                        <div class="controls" style="padding-top:14px">
                            <label style="display:inline-block;width:60px;">
<input checked="checked" data-val="true" data-val-number="The field Gender must be a number." data-val-required="The Gender field is required." id="Gender" name="Gender" type="radio" value="1" />                                男
                            </label>
                            <label style="display:inline-block;width:60px;">
<input id="Gender" name="Gender" type="radio" value="2" />                                女
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
						<label class="control-label" style="margin-top:3px">安全验证<em style="color:red;">*</em></label>
						
						<script type="text/javascript" src="https://api.geetest.com/get.php?gt=7a5d83647ca6c3e1d57af217a2e34e20"></script>
                    </div>
                    <div class="form-actions text-center">
                        <button class="btn btn-primary btn-lg" type="submit">确认修改</button>
                    </div>
                </fieldset>
</form>        </div>
    </div>
</div>
<div class="modal fade" id="dlg_valid_contact" style="z-index:1051">
	<div class="modal-dialog" style="width:550px;">
		<div class="modal-content">
			<div class="modal-header">
				<button class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">验证联系方式</h4>
			</div>
			<div class="modal-body">
				<div id="valid_process_loading" style="padding:30px 20px;display:none;">
					<img src='./static/img/loading.gif'/>正在处理中，请稍候...
				</div> 
				<div id="valid_content" style="padding:20px 20px 15px;">
					<div style="font-weight:bold;margin-top:5px">
						验证联系方式能加强帐户户安全，可便捷找回密码，订购电子票也可快速取票。
					</div>
					<br/>
					<div id="valid_contact_msg"></div>
				    <input id="valid_contact_type" type="hidden" value="0"/>
					<form class = "form-horizontal">
						<div class="control-group">
							<label class="control-label" id="valid_contact_type_label">验证电子邮箱</label>
							<div class="controls">
								<input type="text" value="" class="input-medium" id="valid_contact_type_val"/>
								<a id="valid_send_code_btn" href="#" class="btn btn-success" >
									<i class="icon-share-alt icon-white"></i>&nbsp;发送验证码 <span id="sending_animal_remain" style="display:none;"></span>
								</a>
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" >请输入收到的验证码</label>
							<div class="controls">
								<input id="valid_contact_code" type="text" value="" class="input-medium"/>
								<button id="valid_submit_btn" type="button" class="btn btn-primary" onclick="javascript:submitValidContact();">
									<i class="icon-ok icon-white"></i>&nbsp;确&nbsp;定&nbsp;
								</button>
							</div>
						</div>
					</form>
					<br/>
				</div> 
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					<i class="icon-off"></i>&nbsp;关闭&nbsp;
				</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	var animal_sending_timer = null;
	var onContactValidSuccess = null;
	function startValidUserContact(type, val, autoSend, func){
		$("#valid_contact_type").val(type);
		$("#valid_contact_type_label").html(type == 0 ? "验证电子邮箱" : "验证手机号码");
		if(val != null && $.trim(val) != "") $("#valid_contact_type_val").val(val);
		$("#valid_contact_type_val").prop("disabled", false);
		$("#valid_contact_msg").empty();
		$('#dlg_valid_contact').modal({show: true,backdrop:"static"});
		$("#valid_contact_code").val("");
		if(autoSend) sendActivatecode();
		onContactValidSuccess = func;
	}
	function submitValidContact(){
		if ($.trim($("#valid_contact_code").val()) == "") {
            window.alert("请输入您收到的验证码。");
            return false;
        }
        var btnSubmit = $("#valid_submit_btn");
        //btnSubmit.button('验证中...');
        //setTimeout(function () { btnSubmit.button('reset'); }, 3000);
        $("#valid_process_loading").show();
        $("#valid_content").hide();
		var type = $("#valid_contact_type").val();
		var aim = $("#valid_contact_type_val").val();
        $.ajax({
            url: '/account/activate',
            type: "GET",
            global: false,
			cache: false,
            data: { "code": $("#valid_contact_code").val(), "type":  type, "aim": aim},
            success: function (data) {
				if(data != null && data.AjaxErrStatus != null && data.AjaxErrStatus == 1){
					$("#valid_content").show();
					$("#valid_contact_msg").empty();
					$("#valid_contact_msg").append('<div class="alert alert-error">确定验证码出错，原因：' + data.AjaxErrMsg + '</div>');
					return;
				}

                $("#valid_process_loading").hide();
                $("#valid_content").show();
                $("#valid_contact_msg").empty();
                if (data != null && data == true) {
                    $('#dlg_valid_contact').modal('hide');
					try{
						if(onContactValidSuccess != null && typeof(onContactValidSuccess) == 'function'){
							onContactValidSuccess(parseInt(type), aim);
						}
					}
					catch(e){}
                } else {
                    $("#valid_contact_code").val("");
                    $("#valid_contact_msg").append('<div class="alert alert-error">验证码错误或已无效，请重试。</div>');
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
				$("#valid_process_loading").hide();
                $("#valid_content").show();
                $("#valid_contact_msg").empty();
				$("#valid_contact_msg").append('<div class="alert alert-error">确定验证码出错，原因：服务不存在或无响应</div>');
            }
        });
	}
	
	var time_remain;
    function sendActivatecode() {
		if($("#valid_send_code_btn").is(".disabled")) return;
		var aim = $("#valid_contact_type_val").val();
		var type = $("#valid_contact_type").val();
		if(aim == null || $.trim(aim) == ""){
			$("#valid_contact_msg").append('<div class="alert alert-error">请输入' + (type=="0"?'邮箱地址':'手机号码') + '。</div>');
			return;
		}
        $("#valid_content").hide();
        $("#valid_process_loading").show();
        $("#valid_contact_code").val("");

		$("#valid_send_code_btn").addClass("disabled");
		time_remain = 120;
		$("#sending_animal_remain").show();
		animal_sending_timer = window.setInterval(animalSendingBtn, 1000);
		$("#valid_contact_type_val").prop("disabled", true);
        setTimeout(function () {
            $.ajax({
                url: '/account/send_valid_key',
                type: "POST",
                global: false,
				cache: false,
				data: { "type": type, "aim": aim, "token": "12D7C005834E9000020E97065C76CBE5D80F4646F3D7EE3AC9" },
				dataType: $.browser.msie && $.browser.version == '7.0' ? 'text' : null,
                success: function (data) {
					if(data != null && data.AjaxErrStatus != null && data.AjaxErrStatus == 1){
						$("#valid_process_loading").hide();
						$("#valid_content").show();
						$("#valid_contact_msg").empty();
						$("#valid_contact_msg").append('<div class="alert alert-error">发送验证码出错，原因：' +  data.AjaxErrMsg + '</div>');
						$("#valid_contact_type_val").prop("disabled", false);
						time_remain = 0;
						return;
					}

                    $("#valid_process_loading").hide();
                    $("#valid_content").show();
                    $("#valid_contact_msg").empty();
                    if (data != null && data > 0) {
                        if ($("#valid_contact_type").val() == 1) {
                            $("#valid_contact_msg").append('<div class="alert alert-success"><strong>验证码已成功发送到您的手机。</strong>&nbsp;（如您一直没有收到，可点击“发送验证码”按钮重新发送，一日内限发三次）</div>');
                        } else {
                            $("#valid_contact_msg").append('<div class="alert alert-success"><strong>验证码已成功发到您的信箱。</strong>&nbsp;（如您一直没有收到，可点击“发送验证码”按钮重新发送，一日内限发五次）</div>');
                        }
                    } else {
                        $("#valid_contact_msg").append('<div class="alert alert-error">验证码发送出错，请稍候重试。</div>');
						$("#valid_contact_type_val").prop("disabled", false);
						time_remain = 0;
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
					$("#valid_process_loading").hide();
                    $("#valid_content").show();
                    $("#valid_contact_msg").empty();
					$("#valid_contact_msg").append('<div class="alert alert-error">发送验证码出错，原因：服务不存在或无响应</div>');
					$("#valid_contact_type_val").prop("disabled", false);
					time_remain = 0;
                }
            });
        }, 1000);
    }

	function animalSendingBtn() {
		if(time_remain > 0){
			time_remain = time_remain - 1;
			$("#sending_animal_remain").html(time_remain);
		}
		else{
			try{ window.clearInterval(animal_sending_timer); } catch(e){}
			$("#valid_send_code_btn").removeClass("disabled");
			$("#sending_animal_remain").hide();
		}
    }
</script>

 
	<!-- footer html template -->
	<script type="text/javascript">util.footerhtml()</script>
   


<div class="modal fade modal-confirm" id="promo-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">操作提示</h4>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom: 10px;">关注 活动行 微信服务号</div>
                    <img src="http://cdn.huodongxing.com/Content/v2.0/img/qr_normal.png" alt="">
                    <div style="margin: 10px 0;">点击菜单 - 高级 - 推广合作</div>
                    <img src="./static/v2.0/img/wechat_promo.jpg" alt="">
                </div>
            </div>
        </div>
    </div>
		<div class="feedback-layer modal fade" id="home_feedback_layer">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						<h4 class="modal-title">让批评和口水来的更猛烈些吧！</h4>
					</div>
					<div class="modal-body">
						
						<div class="feedback-face"></div>
						<form action="">
							<input class="form-control" type="text" placeholder="请输入您的邮箱/手机号" id="home_suggest_contact" max-length="64" value=""/>
							<textarea placeholder="在这里写下您想说的话。" id="home_suggest_content" max-length="512"></textarea>
							<div class="text-right">
								<button type="button" class="btn btn-link" data-dismiss="modal">取消</button><button type="button" class="btn btn-primary btn-lg" onclick="javascript:submitMySuggestion();">发送</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<div class="bottom_tools" style="display:block;">
	        <div class="qr_tool">
	            二维码
	        </div>
	        <a id="feedback" href="#home_feedback_layer" data-toggle="modal" title="意见反馈">意见反馈</a>
	        <a id="scrollUp" href="#" title="飞回顶部" style="display:none;"></a>
			<img class="qr_img fade hide" src="./static/v2.0/img/css/qr_img.png">
	    </div>
		<div class="modal fade" id="pop_message_dlg" style="margin-top:250px;overflow-y:auto;z-index:10000">
			<div class="modal-dialog" style="width:550px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						<h4 class="modal-title" id="pop_msg_head"><span class="icon-danger" id="pop_message_icon"></span><span id="pop_message_content"></span></h4>
					</div>
				</div>
			</div>
		</div>

		<div id="jquery_ajax_loading" class="layer-warning modal" style="margin-top:250px;overflow-y:auto;">
			<div class="modal-dialog" style="width:450px;">
				<div class="modal-content">
					<div class="modal-body">
						<p><span class="icon-warning"></span> 页面正在加载中，请耐心等待...</p>
					</div>
					
				</div>
			</div>
		</div>
        <script type="text/javascript" src="./static/js/libs.min.js"></script>
		
	<script type="text/javascript">
       $(function () {
			$("#edit_profile_form").validate({
				submitHandler: function (form) {
					form.submit();
				}
			});
       });

       function refreshProfilePage(type, aim){
			if(type == 1){
				$("#edit_profile_phone").prop("readonly", true);
				$("#btnValidPhone").hide();
			}
			else if(type == 0){
				$("#edit_profile_email").prop("readonly", true);
				$("#btnValidEmail").hide();
			}
			else window.location = window.location;
        }
       
        function saveSmallLogo(eleobj){
			$("#crop_small_logo").attr("disabled", true);
			$.ajax({
				type: 'POST',
                global: false,
				url: "/file/UploadUserLogo",
				data: {"cx":$("#cx").val(),"cy":$("#cy").val(),"cx2":$("#cx2").val(),"cy2":$("#cy2").val(),"cw":$("#cw").val(),"ch":$("#ch").val(),"cropLogo":"true","webTokenValue":"12D7C005834E90000236E45A6F6C1F64379B525CE26E6C7F473D8AE05E107FB35D"},
				success: function(data){
					if(data != null && typeof (data.AjaxErrStatus) != "undefined" && data.AjaxErrStatus == 1){
						PopupMessage(1, "剪裁头像出错，原因：" + data.AjaxErrMsg, 3000);
						$("#crop_small_logo").prop("disabled", false);
						return;
					}
					if (data != null && typeof (data) != "undefined" && data != '' && data != 'null'){ 
                        var datastr = $.trim(data);
                        result  = JSON.parse(datastr);
                        if(result.logo != null && typeof (result.logo) != "undefined" && result.logo != '' && result.logo != 'null')
                            $("#Logo").val(result.logo);
                        if(result.logoLarge != null && typeof (result.logoLarge) != "undefined" && result.logoLarge != '' && result.logoLarge != 'null')
                            $("#LogoLarge").val(result.logoLarge);
						PopupMessage(0, "剪裁缩图成功。", 1500);
					}else{
						PopupMessage(1, "剪裁头像出错，请稍候重试。", 3000);
					}
					$("#crop_small_logo").attr("disabled", false);
				},
				error: function (XMLHttpRequest, textStatus, errorThrown) {
					PopupMessage(1, "剪裁头像出错，请稍候重试。", 3000);
					$("#crop_small_logo").attr("disabled", false);
				}
			});
        }

		function setDefaultRegion(){
			if(remote_ip_info != null){
				$("#pro option").filter(function () {
					//may want to use $.trim in here
					return $(this).text() == remote_ip_info.province;
				}).attr('selected', true).change();
				$("#city option").filter(function () {
					//may want to use $.trim in here
					return $(this).text() == remote_ip_info.city;
				}).attr('selected', true);
			}
		}

        $(function () {
            $.initProv("#pro", "#city", "", "");
            $("#pro").change(function(){
                $("input[name=Province][type=hidden]").val($("#pro option:selected").text());
            });
            $("#city").change(function(){
                $("input[name=City][type=hidden]").val($("#city option:selected").text());
            });
            $('#edit_profile_form select').selectpicker()

            if (true) {
                setDefaultRegion();
            }

            if (!false) {
                if (document.getElementById("user_logo_image").naturalWidth == 0) {
                    document.getElementById("user_logo_image").onload = function() {
                        initCrop();
                    }
                } else {
                    initCrop();
                }
            }

            $('#user_logo_upload_form').fileupload({
                  autoUpload: true,
                  maxNumberOfFiles: 1,
                  maxFileSize: 100000,
				  pasteZone: null,
				  dropZone: null,
                  acceptFileTypes: /(\.|\/)(gif|jpe?g|png|bmp)$/i,
                  done: function (e, data) {
                      var result = "";
                      if (typeof (data.result) == 'string') result = $.trim(data.result);
                      else {
                          if (data.result[0] != null && data.result[0].activeElement != null) result = $.trim(data.result[0].activeElement.innerText);
                      }
                      if (result.indexOf("ERROR") >= 0) {
                          window.alert("对不起，上传头像出错，原因：" + result.substring(7));
                      }
                      else {
                          //if (result != null && typeof (result) != "undefined") result = result.replace(/\"/g, "");
                          if (result != null && typeof (result) != "undefined" && result != '' && result != 'null'){ 
                            result  = JSON.parse(result);
                            if(result.logo != null && typeof (result.logo) != "undefined" && result.logo != '' && result.logo != 'null')
                                $("#Logo").val(result.logo);
                            if(result.logoLarge != null && typeof (result.logoLarge) != "undefined" && result.logoLarge != '' && result.logoLarge != 'null')
                                $("#LogoLarge").val(result.logoLarge);

                            var now=new Date();
                            var logoUrl='/logo/' + result.logoLarge+"?"+ now.getTime();
                            $("#user_logo_image").prop("src", logoUrl);
                            $(".jcrop-holder img").prop("src", logoUrl);
                            initCrop();
							PopupMessage(0, "上传头像成功！", 1500);
                          } else {
                              window.alert("对不起，上传头像出错，请稍候重试。");
                          }
                      }
                  },
                  fail: function (e, data) {
                      window.alert("对不起，上传头像出错，请稍候重试。");
                  }
            });

            function initCrop() {
                var x=0, y=0;
                var percentage = document.getElementById("user_logo_image").naturalWidth / 180;
                var crop = new Array() ;
crop=[0,0,100,100];                jcrop_api=$('#user_logo_image').Jcrop({
                    onSelect: showPreview,
                    onChange: showPreview,
                    setSelect: crop ,
                    aspectRatio: 1
                });
            }
        
            function showPreview(coords) {
                var percentage = document.getElementById("user_logo_image").naturalWidth / 180;
                $("#preview").attr("src",$("#user_logo_image").attr("src"));
                $("#cx").val(coords.x * percentage);
                $("#cy").val(coords.y * percentage);
                $("#cx2").val(coords.x2 * percentage);
                $("#cy2").val(coords.y2 * percentage);
                $("#cw").val(coords.w * percentage);
                $("#ch").val(coords.h * percentage);
                var imgW = $("#user_logo_image").width();
                var imgH = $("#user_logo_image").height();
                if (parseInt(coords.w) > 0) {
                    var rx = 48/coords.w;
                    var ry = 48/coords.h;
                    $('#preview').css({
                        width: Math.round(rx * imgW) + 'px',
                        height: Math.round(ry * imgH) + 'px',
                        marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                        marginTop: '-' + Math.round(ry * coords.y) + 'px'
                    });
                }
            }
            $('.icon-refresh-code').click(function(e) {

                if ($(this).hasClass('active')) return
                $(this).addClass('active');
                setTimeout($.proxy(function() {
                    $(this).removeClass('active')
                }, this), 300)
            });
        });
	</script>

		<script type="text/javascript">
			function submitMySuggestion(){
				var sContactVal = $("#home_suggest_contact").val();
				var sContentVal = $("#home_suggest_content").val();
				if(sContactVal == '' || sContentVal == '') return;
				$.ajax({
					url: '/suggest',
					type: "POST",
					data: { "contact": sContactVal, "content": sContentVal, "token":"123BCD85A62AE727D0EC1AB891B49C8FB4703975D56760A2D364FACF83774B7EECBE5A31FC42E1ECFA" },
					success: function (data) {
						window.alert("我们已收到您反馈的意见，感谢对我们的支持。");
						$("#home_feedback_layer").modal("hide");
					}
				});
            }


			+function ($) {
				var $window = $(window);
				var $body = $(document.body);
				var $navBar = $('.hdx-header');
  				var headerHeight = $navBar.outerHeight(true);
				var $subNavBar = $('.sub_nav');
				$body.scrollspy({
					target: '.intro-nav',
					offset: headerHeight + 40
				});
				$window.on('load', function () { $body.scrollspy('refresh'); });

				var $introNav = $('.intro-nav');
				var $bottomTools = $('.bottom_tools');
				var $qrTools = $('.qr_tool');
				var qrImg = $('.qr_img');
				$introNav
					.affix({
					      offset:{
					        bottom:$('.page-footer').outerHeight()
					      }
					    })
					.find('.nav > a').click(function (e) { e.preventDefault(); });

				setTimeout(function () {
					$window.scroll(function () {
						var scrollHeight = $(document).height();
						var scrollTop = $window.scrollTop();
						var $footerHeight = $('.page-footer').outerHeight(true);
						var $windowHeight = $window.innerHeight();
						$window.scrollTop() > 50 ? $("#scrollUp").fadeIn(200) : $("#scrollUp").fadeOut(200);
						$bottomTools.css("bottom", scrollHeight - scrollTop - $footerHeight > $windowHeight ? 20 : $windowHeight + scrollTop + $footerHeight + 20 - scrollHeight);
					});
					$('#scrollUp').click(function (e) {
						e.preventDefault();
						$('html,body').animate({ scrollTop: 0 });
					});
					$qrTools.hover(function(){
				      qrImg.removeClass('hide')
				      $.support.transition ?
				        qrImg
				          .one($.support.transition.end, function(){
				            qrImg.addClass('in')
				          })
				          .emulateTransitionEnd(150) :
				        qrImg.addClass('in')
				    },function(){
				      qrImg.removeClass('in')
				      $.support.transition ?
				        qrImg
				          .one($.support.transition.end, function(){
				            qrImg.addClass('hide')
				          }) :
				        qrImg.addClass('hide')
				    })
				}, 500);
                $('.hdx-header .search').on('click','li a',function(e){
                    e.preventDefault();
                    //var parent= $(this).parent().parent('.dropdown').find('span')[0].innerHTML;
                    //var parent= $(this).parent().parent('.dropdown').find('span')[0].attr("str");
                    var affiliation = $(this).attr("title");
                    var current = $(this).attr("str");
                    if(affiliation != current){
                        $("#searchEventArea").toggle();
                        $("#searchOrgArea").toggle();
                    }
                });
                $("#searchOrgArea button").bind("click", function () {
                    var qs = $("#searchOrgArea input[type='text']").val();
                    if (qs != null && qs != '') {
                        window.location = '/zhubanfang/a?p=1' + encodeURI("&qs=" + qs);
                    }
                });
				$('.aside h2 .more').click(function(e){
				    //e.preventDefault();
				    if ($(this).hasClass('active')) return
				    $(this).addClass('active');
				    setTimeout($.proxy(function(){
				      $(this).removeClass('active')
				    },this),200)
				});
				var $loginToggle = $('.icon-login-toggle');
				  var $iconLogins = $loginToggle.parent();
				  $loginToggle.on('mouseenter',function(){
				    $iconLogins.toggleClass('fold')
				  })
				  $iconLogins.on('mouseleave',function(){
				      $iconLogins.addClass('fold')
				  })
			} (window.jQuery)

			function addFavorite() {
				if (document.all) {
					try {
						window.external.addFavorite(window.location.href, document.title);
					} catch (e) {
						window.alert("对不起，您的浏览器不支持此操作！\n\r请您使用使用Ctrl+D收藏本站");
					}
				} else if (window.sidebar) {
					window.sidebar.addPanel(document.title, window.location.href, "");
				} else {
					window.alert("对不起，您的浏览器不支持此操作！\n\r请您使用使用Ctrl+D收藏本站");
				}
			}
			function forwardEmailLink(email) {
				if (email == null || email == "") return "";
				var emlower = email.toLowerCase();
				var link = "<a target='_blank' href='http://";
				if (emlower.indexOf("@qq.com") > 0 || emlower.indexOf("@163.com") > 0 || emlower.indexOf("@126.com") > 0 || emlower.indexOf("@tom.com") > 0 || emlower.indexOf("@sina.com") > 0 || emlower.indexOf("@yahoo.com") > 0) {
					link += "mail." + emlower.substring(emlower.indexOf("@") + 1);
				}
				else {
					link += "www." + emlower.substring(emlower.indexOf("@") + 1);
				}
				link += "'>前往查收</a>";
				return link;
			}
			function PopupMessage(type, msg, hideTime,backdrop){
				if(msg == null || msg == "" || type < 0) return;
				if(type == 0){
					type = 'icon-success'
				}else if(type == 'warning'){
					type = 'icon-warning'
				}else{
					type = 'icon-danger'
				}
				$("#pop_message_icon").removeClass("icon-danger icon-success icon-warning").addClass(type);
				$("#pop_message_content").html(msg);
                if(msg != null && msg.length <= 25){ $("#pop_msg_head").css("text-align","center"); }
                else{ $("#pop_msg_head").css("text-align","center"); }
				$('#pop_message_dlg').modal({show:true, backdrop:backdrop ? backdrop : false });
				if(hideTime != null && hideTime > 0) window.setTimeout(function () { $('#pop_message_dlg').modal('hide'); }, hideTime);
			}
			function setupScriptDelay(scriptPath, sync, onHead){
				var setupScript = document.createElement("script"); setupScript.type = 'text/javascript';
				if(!sync) setupScript.async = true;
				if(scriptPath.indexOf("http") == 0) setupScript.src = scriptPath;
				else setupScript.src = (("https:" == document.location.protocol) ? "https://" : "http://") + scriptPath;
				if(onHead) document.getElementsByTagName("head")[0].appendChild(setupScript);
				else document.body.appendChild(setupScript);
			}

			function setupGlobalScript(){
				setupScriptDelay("hm.baidu.com/h.js?d89d7d47b4b1b8ff993b37eafb0b49bd", true, true);
				google_analytics_script();
				//alexa_script();
			}
			$(function () {
			    $.ajaxSetup({ timeout: 45000 });
				$(document).ajaxStart(function () {
					var bgfi = $("div.modal-backdrop.in");
					if (bgfi != null && bgfi.length > 0) $('#jquery_ajax_loading').modal({ show: true, backdrop: false, keyboard: false });
					else $('#jquery_ajax_loading').modal({ show: true, backdrop: 'static', keyboard: false });
				}).ajaxSend(function(evt, request, settings) {
				    console.log(settings.url);
				}).ajaxStop(function () {
					$('#jquery_ajax_loading').modal('hide');
					var bgfi = $("div.modal-backdrop.in");
					if (bgfi == null || bgfi.length == 0){ $("body").removeClass("modal-open"); }
				});
				window.setTimeout("setupGlobalScript()", 350);
			});
			//var _bdhmProtocolExternal = (("https:" == document.location.protocol) ? " https://" : " http://");
			//document.write(unescape("%3Cscript src='" + _bdhmProtocolExternal + "hm.baidu.com/h.js%3Fd89d7d47b4b1b8ff993b37eafb0b49bd' type='text/javascript'%3E%3C/script%3E"));
		</script>

	</body>
</html>